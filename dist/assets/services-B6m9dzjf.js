class c{constructor(){this.storageKey="polymershop-cart-v2",this.listeners=[],this.cart=this.loadCart(),this.debouncedSave=this.debounce(this.saveCart.bind(this),300),window.addEventListener("storage",this.handleStorageChange.bind(this))}debounce(e,t){let a;return function(...i){const s=()=>{clearTimeout(a),e(...i)};clearTimeout(a),a=setTimeout(s,t)}}loadCart(){try{const e=localStorage.getItem(this.storageKey);if(!e)return[];const t=JSON.parse(e);if(!Array.isArray(t))return console.warn("Invalid cart data structure, resetting cart"),[];const a=t.map(r=>({...r,addedAt:r.addedAt||new Date().toISOString(),updatedAt:r.updatedAt||new Date().toISOString()}));return console.log(`ğŸ›’ Loaded ${a.length} items from cart storage`),a}catch(e){return console.error("âŒ Error loading cart:",e),[]}}saveCart(){try{const e=this.cart.map(t=>({...t,updatedAt:new Date().toISOString()}));localStorage.setItem(this.storageKey,JSON.stringify(e)),console.log(`ğŸ’¾ Saved ${e.length} items to cart storage`)}catch(e){console.error("âŒ Error saving cart:",e);try{const t=this.cart.map(({id:a,quantity:r})=>({id:a,quantity:r}));localStorage.setItem(this.storageKey,JSON.stringify(t)),console.log("âš ï¸ Saved minimal cart data")}catch(t){console.error("âŒ Fallback save also failed:",t)}}}handleStorageChange(e){e.key===this.storageKey&&e.newValue!==e.oldValue&&(console.log("ğŸ”„ Cart updated from another tab"),this.cart=this.loadCart(),this.dispatchCartUpdate())}getCart(){return[...this.cart]}addToCart(e,t=1,a={}){if(!e||!e.id)return console.error("âŒ Invalid product data"),!1;if(t<=0)return console.warn("âš ï¸ Invalid quantity, must be positive"),!1;const r=this.cart.find(i=>i.id===e.id);return r?(r.quantity+=t,r.updatedAt=new Date().toISOString(),a.maxStock&&r.quantity>a.maxStock&&(r.quantity=a.maxStock,console.warn(`âš ï¸ Stock limit reached for ${e.name}`))):this.cart.push({id:e.id,name:e.name,price:e.price,originalPrice:e.originalPrice||e.price,image:e.image,quantity:t,addedAt:new Date().toISOString(),updatedAt:new Date().toISOString(),category:e.category,...a}),this.debouncedSave(),this.dispatchCartUpdate(),console.log(`â• Added ${t}x ${e.name} to cart`),!0}removeFromCart(e){const t=this.cart.findIndex(a=>a.id===e);if(t>-1){const a=this.cart.splice(t,1)[0];return this.debouncedSave(),this.dispatchCartUpdate(),console.log(`ğŸ—‘ï¸ Removed ${a.name} from cart`),!0}return!1}updateQuantity(e,t){const a=this.cart.find(r=>r.id===e);return a?t<=0?this.removeFromCart(e):(a.quantity=t,a.updatedAt=new Date().toISOString(),this.debouncedSave(),this.dispatchCartUpdate(),console.log(`ğŸ“ Updated ${a.name} quantity to ${t}`),!0):!1}clearCart(){const e=this.cart.length;return this.cart=[],this.saveCart(),this.dispatchCartUpdate(),console.log(`ğŸ§¹ Cleared cart (${e} items removed)`),!0}getCartTotal(){return this.cart.reduce((e,t)=>e+t.price*t.quantity,0)}getCartSubtotal(){return this.getCartTotal()}getCartItemCount(){return this.cart.reduce((e,t)=>e+t.quantity,0)}isCartEmpty(){return this.cart.length===0}getCartItem(e){return this.cart.find(t=>t.id===e)||null}getItemsByCategory(e){return this.cart.filter(t=>t.category===e)}hasItem(e){return this.cart.some(t=>t.id===e)}getItemQuantity(e){const t=this.getCartItem(e);return t?t.quantity:0}dispatchCartUpdate(){const e=new CustomEvent("cart-updated",{detail:{cart:this.getCart(),total:this.getCartTotal(),subtotal:this.getCartSubtotal(),itemCount:this.getCartItemCount(),summary:this.getCartSummary(),timestamp:new Date().toISOString()}});window.dispatchEvent(e),this.listeners.forEach(t=>{try{t(e.detail)}catch(a){console.error("âŒ Error in cart listener:",a)}})}addListener(e){return this.listeners.push(e),()=>{const t=this.listeners.indexOf(e);t>-1&&this.listeners.splice(t,1)}}applyDiscount(e){const a={WELCOME10:{type:"percentage",value:10,description:"Welcome discount"},SAVE20:{type:"percentage",value:20,description:"Flash sale"},FREESHIP:{type:"shipping",value:0,description:"Free shipping"},FLAT10:{type:"fixed",value:10,description:"$10 off"},STUDENT15:{type:"percentage",value:15,description:"Student discount"},LOYALTY5:{type:"percentage",value:5,description:"Loyalty reward"}}[e?.toUpperCase()];return a?{success:!0,discount:a,message:`âœ… ${a.description} applied!`,code:e.toUpperCase()}:{success:!1,message:"Invalid discount code",code:null}}calculateShipping(e="standard"){const t={standard:5.99,express:12.99,overnight:24.99,free:0},a=this.getCartSubtotal();return a>=75&&e==="standard"||a>=100?0:t[e]||t.standard}calculateTax(e){return e*.08}getCartSummary(){const e=this.getCartSubtotal(),t=this.calculateShipping(),a=this.calculateTax(e),r=e+t+a;return{subtotal:parseFloat(e.toFixed(2)),shipping:parseFloat(t.toFixed(2)),tax:parseFloat(a.toFixed(2)),total:parseFloat(r.toFixed(2)),itemCount:this.getCartItemCount(),itemTypes:this.cart.length,freeShippingThreshold:75,isFreeShipping:t===0,savings:this.calculateSavings()}}calculateSavings(){return this.cart.reduce((e,t)=>t.originalPrice&&t.originalPrice>t.price?e+(t.originalPrice-t.price)*t.quantity:e,0)}getAnalytics(){const e={};let t=0,a=null,r=null;return this.cart.forEach(i=>{const s=i.category||"uncategorized";e[s]=(e[s]||0)+i.quantity,t+=i.price*i.quantity,(!a||i.addedAt<a.addedAt)&&(a=i),(!r||i.addedAt>r.addedAt)&&(r=i)}),{categories:e,totalValue:parseFloat(t.toFixed(2)),itemCount:this.getCartItemCount(),itemTypes:this.cart.length,oldestItem:a,newestItem:r,averageItemValue:this.cart.length>0?parseFloat((t/this.cart.length).toFixed(2)):0,cartAge:a?Math.floor((new Date-new Date(a.addedAt))/(1e3*60*60*24)):0}}exportCart(){return{version:"2.0",items:this.getCart(),summary:this.getCartSummary(),analytics:this.getAnalytics(),timestamp:new Date().toISOString(),metadata:{userAgent:navigator.userAgent,exportDate:new Date().toISOString(),cartVersion:"2.0"}}}importCart(e){if(!e||!e.items||!Array.isArray(e.items))return console.error("âŒ Invalid cart data format"),!1;try{const t=e.items.filter(a=>a.id&&a.name&&typeof a.price=="number"&&a.quantity>0);return t.length!==e.items.length&&console.warn("âš ï¸ Some cart items were filtered out during import"),this.cart=t.map(a=>({...a,importedAt:new Date().toISOString(),updatedAt:new Date().toISOString()})),this.saveCart(),this.dispatchCartUpdate(),console.log(`ğŸ“¥ Imported ${this.cart.length} items to cart`),!0}catch(t){return console.error("âŒ Error importing cart:",t),!1}}createBackup(){const e=`backup_${Date.now()}`,t=this.exportCart();try{return localStorage.setItem(`polymershop-backup-${e}`,JSON.stringify(t)),console.log(`ğŸ’¾ Cart backup created: ${e}`),e}catch(a){return console.error("âŒ Error creating backup:",a),null}}restoreBackup(e){try{const t=localStorage.getItem(`polymershop-backup-${e}`);if(!t)return console.error("âŒ Backup not found:",e),!1;const a=JSON.parse(t);return this.importCart(a)}catch(t){return console.error("âŒ Error restoring backup:",t),!1}}getBackups(){const e=[];for(let t=0;t<localStorage.length;t++){const a=localStorage.key(t);if(a&&a.startsWith("polymershop-backup-"))try{const r=JSON.parse(localStorage.getItem(a));e.push({id:a.replace("polymershop-backup-",""),timestamp:r.timestamp,itemCount:r.items.length,total:r.summary.total})}catch{}}return e.sort((t,a)=>new Date(a.timestamp)-new Date(t.timestamp))}cleanupBackups(e=5){const t=this.getBackups();if(t.length<=e)return;const a=t.slice(e);a.forEach(r=>{localStorage.removeItem(`polymershop-backup-${r.id}`)}),console.log(`ğŸ§¹ Cleaned up ${a.length} old backups`)}destroy(){window.removeEventListener("storage",this.handleStorageChange),this.listeners=[],this.cart=[]}}class l{constructor(){this.imageFallbacks={electronics:"/images/electronics-placeholder.svg",clothing:"/images/clothing-placeholder.svg",home:"/images/home-placeholder.svg",sports:"/images/sports-placeholder.svg"},this.products=[{id:1,name:"Wireless Bluetooth Headphones",description:"Premium noise-canceling headphones with 30-hour battery life and crystal clear sound quality.",price:199.99,category:"electronics",image:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=400&h=300&fit=crop",fallbackImage:this.imageFallbacks.electronics,rating:4.8,reviews:1247,inStock:!0,features:["Active Noise Cancellation","30-hour battery life","Bluetooth 5.0","Built-in microphone","Foldable design"]},{id:2,name:"Smart Fitness Watch",description:"Advanced fitness tracking with heart rate monitoring, GPS, and water resistance up to 50m.",price:299.99,category:"electronics",image:"https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=400&h=300&fit=crop",fallbackImage:this.imageFallbacks.electronics,rating:4.6,reviews:892,inStock:!0,features:["Heart rate monitoring","GPS tracking","Water resistant","7-day battery life","Sleep tracking"]},{id:3,name:"Organic Cotton T-Shirt",description:"Comfortable and sustainable cotton t-shirt made from 100% organic materials.",price:29.99,category:"clothing",image:"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=400&h=300&fit=crop",fallbackImage:this.imageFallbacks.clothing,rating:4.4,reviews:567,inStock:!0,features:["100% organic cotton","Breathable fabric","Multiple colors available","Sizes XS-XXL","Machine washable"]},{id:4,name:"Modern Coffee Table",description:"Elegant wooden coffee table with storage shelf, perfect for modern living rooms.",price:249.99,category:"home",image:"https://images.unsplash.com/photo-1533090481720-856c6e3c1fdc?w=400&h=300&fit=crop",fallbackImage:this.imageFallbacks.home,rating:4.7,reviews:234,inStock:!0,features:["Solid wood construction","Storage shelf","Easy assembly","Multiple finishes","2-year warranty"]},{id:5,name:"Wireless Gaming Mouse",description:"High-precision gaming mouse with customizable RGB lighting and programmable buttons.",price:79.99,category:"electronics",image:"https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?w=400&h=300&fit=crop",fallbackImage:this.imageFallbacks.electronics,rating:4.5,reviews:445,inStock:!0,features:["25K DPI sensor","RGB lighting","Programmable buttons","Wireless connectivity","50-hour battery"]},{id:6,name:"Yoga Mat Premium",description:"Non-slip yoga mat with alignment lines, perfect for yoga, pilates, and fitness workouts.",price:49.99,category:"sports",image:"https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=400&h=300&fit=crop",fallbackImage:this.imageFallbacks.sports,rating:4.9,reviews:1234,inStock:!0,features:["Non-slip surface","Alignment lines","6mm thickness","Eco-friendly materials","Includes carrying strap"]},{id:7,name:"Digital Camera DSLR",description:"Professional DSLR camera with 24MP sensor, 4K video recording, and interchangeable lenses.",price:899.99,category:"electronics",image:"https://images.unsplash.com/photo-1516035069371-29a1b244cc32?w=400&h=300&fit=crop",fallbackImage:this.imageFallbacks.electronics,rating:4.8,reviews:678,inStock:!0,features:["24MP APS-C sensor","4K video recording","Interchangeable lenses","Built-in WiFi","Touch screen display"]},{id:8,name:"Running Shoes",description:"Lightweight running shoes with responsive cushioning and breathable mesh upper.",price:129.99,category:"sports",image:"https://images.unsplash.com/photo-1542291026-7eec264c27ff?w=400&h=300&fit=crop",fallbackImage:this.imageFallbacks.sports,rating:4.6,reviews:892,inStock:!0,features:["Responsive cushioning","Breathable mesh","Lightweight design","Multiple colors","Sizes 7-12"]},{id:9,name:"Smart Home Speaker",description:"Voice-controlled smart speaker with premium sound quality and home automation features.",price:199.99,category:"electronics",image:"https://images.unsplash.com/photo-1545454675-3531b543be5d?w=400&h=300&fit=crop",fallbackImage:this.imageFallbacks.electronics,rating:4.7,reviews:567,inStock:!0,features:["Voice control","Premium sound","Home automation","Multi-room audio","Privacy controls"]},{id:10,name:"Designer Backpack",description:"Stylish and functional backpack with laptop compartment and multiple storage pockets.",price:89.99,category:"clothing",image:"https://images.unsplash.com/photo-1553062407-98eeb64c6a62?w=400&h=300&fit=crop",fallbackImage:this.imageFallbacks.clothing,rating:4.5,reviews:345,inStock:!0,features:["Laptop compartment","Multiple pockets","Water-resistant","Padded straps","15-inch laptop fit"]},{id:11,name:"Kitchen Mixer Stand",description:"Professional stand mixer with 10-speed settings and multiple attachments for all your baking needs.",price:399.99,category:"home",image:"https://images.unsplash.com/photo-1556909114-f6e7ad7d3136?w=400&h=300&fit=crop",fallbackImage:this.imageFallbacks.home,rating:4.9,reviews:789,inStock:!0,features:["10-speed settings","Multiple attachments","5-quart bowl","Tilt-head design","5-year warranty"]},{id:12,name:"Basketball",description:"Official size basketball with premium grip and durability for indoor and outdoor play.",price:39.99,category:"sports",image:"https://images.unsplash.com/photo-1546519638-68e109498ffc?w=400&h=300&fit=crop",fallbackImage:this.imageFallbacks.sports,rating:4.4,reviews:234,inStock:!0,features:["Official size","Premium grip","Indoor/outdoor","Durable construction","Official weight"]}]}async getProducts(){return await new Promise(e=>setTimeout(e,500)),this.products}async getProductById(e){return await new Promise(t=>setTimeout(t,200)),this.products.find(t=>t.id===e)||null}async getProductsByCategory(e){return await new Promise(t=>setTimeout(t,300)),this.products.filter(t=>t.category===e)}async searchProducts(e){await new Promise(a=>setTimeout(a,400));const t=e.toLowerCase();return this.products.filter(a=>a.name.toLowerCase().includes(t)||a.description.toLowerCase().includes(t))}async getCategories(){return await new Promise(e=>setTimeout(e,100)),[...new Set(this.products.map(e=>e.category))]}async getFeaturedProducts(e=6){return await new Promise(t=>setTimeout(t,300)),this.products.sort((t,a)=>a.rating-t.rating).slice(0,e)}async getProductsOnSale(){return await new Promise(e=>setTimeout(e,200)),this.products.sort(()=>.5-Math.random()).slice(0,4).map(e=>({...e,originalPrice:e.price*1.2,discount:20}))}getProductImage(e){return e.image?e.image:e.category&&this.imageFallbacks[e.category]?this.imageFallbacks[e.category]:"/images/default-placeholder.svg"}async preloadImages(e){return await Promise.all(e.map(async a=>{const r=new Image,i=this.getProductImage(a);return new Promise(s=>{r.onload=()=>{s({...a,imageLoaded:!0,currentImage:i})},r.onerror=()=>{if(console.warn(`Failed to load image for ${a.name}, using fallback`),i!==a.fallbackImage&&a.fallbackImage){const o=new Image;o.onload=()=>{s({...a,imageLoaded:!0,currentImage:a.fallbackImage,imageError:!0})},o.onerror=()=>{s({...a,imageLoaded:!1,currentImage:"/images/default-placeholder.svg",imageError:!0})},o.src=a.fallbackImage}else s({...a,imageLoaded:!1,currentImage:"/images/default-placeholder.svg",imageError:!0})},r.src=i})}))}}export{c as C,l as P};
