<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©mo Performance PolymerShop</title>

    <!-- Preload des ressources critiques -->
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" as="style">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap">

    <style>
        :root {
            --primary-color: #3498db;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --error-color: #e74c3c;
            --text-color: #333;
            --bg-color: #f8f9fa;
            --card-bg: #ffffff;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            box-shadow: var(--shadow);
        }

        h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .performance-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .performance-card {
            background: var(--card-bg);
            border-radius: 10px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
        }

        .performance-card:hover {
            transform: translateY(-5px);
        }

        .metric-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .metric-label {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-good { color: var(--success-color); }
        .status-warning { color: var(--warning-color); }
        .status-error { color: var(--error-color); }

        .optimization-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .optimization-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-color);
        }

        .optimization-item h3 {
            margin-top: 0;
            color: var(--primary-color);
        }

        .code-example {
            background: #f4f4f4;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
        }

        .demo-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: var(--shadow);
        }

        .lazy-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #f0f0f0, #e0e0e0);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 10px 0;
            transition: opacity 0.3s ease;
        }

        .lazy-image.loaded {
            opacity: 1;
        }

        .lazy-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 5px;
        }

        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: background 0.3s ease;
        }

        button:hover {
            background: #2980b9;
        }

        .metrics-display {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin: 15px 0;
            font-family: monospace;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success-color), var(--warning-color));
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .performance-grid {
                grid-template-columns: 1fr;
            }

            .optimization-list {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚ö° D√©mo Performance - PolymerShop</h1>
            <p>D√©couvrez les optimisations de performance impl√©ment√©es</p>
        </header>

        <section class="demo-section">
            <h2>üìä M√©triques de Performance en Temps R√©el</h2>
            <div class="performance-grid" id="metrics-grid">
                <div class="performance-card">
                    <div class="metric-label">Largest Contentful Paint</div>
                    <div class="metric-value status-good" id="lcp-value">-- ms</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="lcp-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="performance-card">
                    <div class="metric-label">First Input Delay</div>
                    <div class="metric-value status-good" id="fid-value">-- ms</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="fid-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="performance-card">
                    <div class="metric-label">Cumulative Layout Shift</div>
                    <div class="metric-value status-good" id="cls-value">--</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="cls-bar" style="width: 0%"></div>
                    </div>
                </div>

                <div class="performance-card">
                    <div class="metric-label">First Contentful Paint</div>
                    <div class="metric-value status-good" id="fcp-value">-- ms</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="fcp-bar" style="width: 0%"></div>
                    </div>
                </div>
            </div>

            <button onclick="updateMetrics()">Actualiser les m√©triques</button>
            <button onclick="exportMetrics()">Exporter les donn√©es</button>
        </section>

        <section class="demo-section">
            <h2>üîß Optimisations Impl√©ment√©es</h2>

            <div class="optimization-list">
                <div class="optimization-item">
                    <h3>üì¶ Code Splitting</h3>
                    <p>S√©paration intelligente du bundle JavaScript pour r√©duire la taille du chargement initial.</p>
                    <div class="code-example">
// Configuration Vite optimis√©e
rollupOptions: {
  output: {
    manualChunks: {
      vendor: ['lit'],
      services: ['./src/services/*.js'],
      components: ['./src/components/*.js']
    }
  }
}
                    </div>
                </div>

                <div class="optimization-item">
                    <h3>üñºÔ∏è Lazy Loading</h3>
                    <p>Chargement des images uniquement quand elles deviennent visibles.</p>
                    <div class="code-example">
// Intersection Observer pour lazy loading
const imageObserver = new IntersectionObserver((entries) => {
  entries.forEach(entry => {
    if (entry.isIntersecting) {
      const img = entry.target;
      img.src = img.dataset.src;
      img.classList.remove('lazy');
      observer.unobserve(img);
    }
  });
});
                    </div>
                </div>

                <div class="optimization-item">
                    <h3>üíæ Cache DOM</h3>
                    <p>Mise en cache des r√©f√©rences DOM fr√©quemment utilis√©es.</p>
                    <div class="code-example">
// Cache DOM optimis√©
_getCachedElement(selector) {
  if (!this._domCache.has(selector)) {
    const element = this.shadowRoot ?
      this.shadowRoot.querySelector(selector) :
      document.querySelector(selector);
    if (element) {
      this._domCache.set(selector, element);
    }
  }
  return this._domCache.get(selector);
}
                    </div>
                </div>

                <div class="optimization-item">
                    <h3>‚è±Ô∏è Debounce</h3>
                    <p>Optimisation des recherches pour √©viter les appels trop fr√©quents.</p>
                    <div class="code-example">
// Debounce pour optimiser les recherches
_debounceSearch(func, wait) {
  clearTimeout(this._debounceTimer);
  this._debounceTimer = setTimeout(func, wait);
}
                    </div>
                </div>

                <div class="optimization-item">
                    <h3>üéØ Pr√©chargement</h3>
                    <p>Pr√©chargement des ressources critiques au d√©marrage.</p>
                    <div class="code-example">
// Pr√©chargement des ressources critiques
_preloadCriticalResources() {
  // Pr√©charger les polices
  const fontLink = document.createElement('link');
  fontLink.rel = 'preload';
  fontLink.href = 'https://fonts.googleapis.com/...';
  fontLink.as = 'style';
  document.head.appendChild(fontLink);
}
                    </div>
                </div>

                <div class="optimization-item">
                    <h3>üñºÔ∏è Optimisation Images</h3>
                    <p>Attributs loading="lazy" et decoding="async" pour toutes les images.</p>
                    <div class="code-example">
// Images avec lazy loading
html`<svg width="80" height="80"
         loading="lazy"
         decoding="async">
  <!-- Contenu SVG optimis√© -->
</svg>`
                    </div>
                </div>
            </div>
        </section>

        <section class="demo-section">
            <h2>üñºÔ∏è D√©monstration Lazy Loading</h2>
            <p>Ces images se chargent uniquement quand elles deviennent visibles dans la fen√™tre.</p>

            <div class="lazy-image" data-src="https://picsum.photos/400/200?random=1">
                <div>Image 1 - Lazy Loaded</div>
            </div>

            <div class="lazy-image" data-src="https://picsum.photos/400/200?random=2">
                <div>Image 2 - Lazy Loaded</div>
            </div>

            <div class="lazy-image" data-src="https://picsum.photos/400/200?random=3">
                <div>Image 3 - Lazy Loaded</div>
            </div>
        </section>

        <section class="demo-section">
            <h2>üîç Outils de Mesure</h2>
            <p>Utilisez ces outils pour mesurer les performances de votre application.</p>

            <div class="optimization-list">
                <div class="optimization-item">
                    <h3>Lighthouse</h3>
                    <p>Outil int√©gr√© √† Chrome DevTools pour mesurer les Core Web Vitals.</p>
                    <button onclick="runLighthouse()">Ouvrir Lighthouse</button>
                </div>

                <div class="optimization-item">
                    <h3>WebPageTest</h3>
                    <p>Test de performance avanc√© avec m√©triques d√©taill√©es.</p>
                    <a href="https://www.webpagetest.org/" target="_blank">
                        <button>Ouvrir WebPageTest</button>
                    </a>
                </div>

                <div class="optimization-item">
                    <h3>PageSpeed Insights</h3>
                    <p>Outil Google pour analyser les performances mobiles et desktop.</p>
                    <a href="https://pagespeed.web.dev/" target="_blank">
                        <button>Ouvrir PageSpeed</button>
                    </a>
                </div>
            </div>
        </section>
    </div>

    <!-- Script de monitoring Core Web Vitals -->
    <script src="core-web-vitals.js"></script>

    <script>
        // Mise √† jour des m√©triques en temps r√©el
        function updateMetrics() {
            if (window.coreWebVitalsMonitor) {
                const vitals = window.coreWebVitalsMonitor.getVitals();

                // Mettre √† jour LCP
                if (vitals.lcp) {
                    document.getElementById('lcp-value').textContent = vitals.lcp.value + ' ms';
                    const lcpPercent = Math.min(100, (vitals.lcp.value / 4000) * 100);
                    document.getElementById('lcp-bar').style.width = (100 - lcpPercent) + '%';
                }

                // Mettre √† jour FID
                if (vitals.fid) {
                    document.getElementById('fid-value').textContent = vitals.fid.value + ' ms';
                    const fidPercent = Math.min(100, (vitals.fid.value / 300) * 100);
                    document.getElementById('fid-bar').style.width = (100 - fidPercent) + '%';
                }

                // Mettre √† jour CLS
                if (vitals.cls) {
                    document.getElementById('cls-value').textContent = vitals.cls.value;
                    const clsPercent = Math.min(100, vitals.cls.value * 1000);
                    document.getElementById('cls-bar').style.width = (100 - clsPercent) + '%';
                }

                // Mettre √† jour FCP
                if (vitals.fcp) {
                    document.getElementById('fcp-value').textContent = vitals.fcp.value + ' ms';
                    const fcpPercent = Math.min(100, (vitals.fcp.value / 3000) * 100);
                    document.getElementById('fcp-bar').style.width = (100 - fcpPercent) + '%';
                }

                console.log('üìä M√©triques mises √† jour:', vitals);
            }
        }

        // Export des m√©triques
        function exportMetrics() {
            if (window.exportCoreWebVitals) {
                const data = window.exportCoreWebVitals();
                console.log('üì§ Donn√©es export√©es:', data);

                // Cr√©er un blob pour le t√©l√©chargement
                const blob = new Blob([JSON.stringify(data, null, 2)], {
                    type: 'application/json'
                });

                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'core-web-vitals-export.json';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                alert('‚úÖ Donn√©es export√©es dans core-web-vitals-export.json');
            }
        }

        // Ouvrir Lighthouse
        function runLighthouse() {
            // Ouvrir Chrome DevTools et aller √† l'onglet Lighthouse
            alert('Ouvrez Chrome DevTools (F12) ‚Üí onglet Lighthouse ‚Üí Generate report');
        }

        // Lazy loading des images de d√©monstration
        function initLazyLoading() {
            const lazyImages = document.querySelectorAll('.lazy-image');

            const imageObserver = new IntersectionObserver((entries, observer) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        const container = entry.target;
                        const img = document.createElement('img');
                        img.src = container.dataset.src;
                        img.alt = 'Image de d√©monstration lazy loaded';
                        img.onload = () => {
                            container.innerHTML = '';
                            container.appendChild(img);
                            container.classList.add('loaded');
                        };
                        observer.unobserve(container);
                    }
                });
            });

            lazyImages.forEach(img => imageObserver.observe(img));
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', function() {
            initLazyLoading();
            updateMetrics();

            // Mise √† jour automatique toutes les 5 secondes
            setInterval(updateMetrics, 5000);
        });

        // Simulation d'interaction pour mesurer FID
        document.addEventListener('click', function() {
            // Cette interaction permettra de mesurer le FID
            console.log('üëÜ Interaction utilisateur d√©tect√©e');
        });
    </script>
</body>
</html>
